{% load static wagtailcore_tags wagtailsettings_tags %}
{% get_settings use_default_site=True %}

{# Access our specific model from the settings object #}
{% with nav_settings=settings.cms_integration.NavigationSettings %}

<header
    x-data="{
        atTop: true,
        mobileMenuOpen: false,
        toggle() { this.mobileMenuOpen = !this.mobileMenuOpen },
        close() { this.mobileMenuOpen = false }
    }"
    x-init="
        $watch('mobileMenuOpen', (open) => {
            if(open) { document.body.style.overflow = 'hidden'; }
            else { document.body.style.overflow = ''; }
        })
    "
    @scroll.window="atTop = (window.pageYOffset < 20)"
    @keydown.escape.window="close()"
    :class="atTop && !mobileMenuOpen ? 'bg-transparent border-transparent' : 'bg-[#020617]/90 backdrop-blur-xl shadow-2xl border-white/5'"
    class="fixed top-0 left-0 w-full z-50 transition-all duration-300 ease-in-out border-b"
>
    <div class="mx-auto flex h-20 max-w-7xl items-center justify-between px-4 sm:px-6">

        <!-- Logo -->
        <a href="/" class="group flex items-center gap-3 z-50 relative">
             <img src="{% static 'img/Website_brain.webp' %}" alt="Odin" width="40" class="h-10 w-auto">
            <span class="font-display text-lg md:text-xl font-bold tracking-tight text-white">
                DXP <span class="text-emerald-400">Odin</span>
            </span>
        </a>

        <!-- Desktop Nav (Dynamic) -->
        <nav class="hidden lg:flex items-center gap-8">
            {% for block in nav_settings.primary_navigation %}
                {% with item=block.value %}
                <a href="{{ item.page.url|default:item.url }}"
                   class="relative text-sm font-medium tracking-wide text-slate-300 hover:text-white transition-colors py-2 group">
                    {{ item.label }}
                    <span class="absolute bottom-0 left-0 h-0.5 w-0 bg-emerald-400 transition-all duration-300 group-hover:w-full"></span>
                </a>
                {% endwith %}
            {% endfor %}
        </nav>

        <!-- CTA -->
        <div class="hidden lg:flex items-center gap-6">
            <a href="#" class="group relative inline-flex items-center justify-center overflow-hidden rounded-full bg-emerald-500 px-6 py-2.5 transition-transform hover:scale-105">
                <span class="relative text-sm font-bold tracking-wide text-white">Get Tickets</span>
            </a>
        </div>

        <!-- Mobile Menu Toggle -->
        <button @click="toggle()" class="lg:hidden relative z-50 text-white p-2">
            <svg x-show="!mobileMenuOpen" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            <svg x-show="mobileMenuOpen" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
    </div>

    <!-- Mobile Menu Overlay -->
    <div
        x-show="mobileMenuOpen"
        style="display: none;"
        x-transition.opacity
        class="fixed inset-0 z-40 bg-[#020617] pt-28 px-6 lg:hidden flex flex-col h-screen overflow-y-auto"
    >
        <nav class="flex flex-col gap-6 text-center">
            {% for block in nav_settings.primary_navigation %}
                {% with item=block.value %}
                <a href="{{ item.page.url|default:item.url }}"
                   @click="close()"
                   class="text-2xl font-display font-bold text-white hover:text-emerald-400">
                    {{ item.label }}
                </a>
                {% endwith %}
            {% endfor %}

            <a href="#" class="mt-8 mx-auto w-full max-w-xs rounded-full bg-emerald-500 py-4 text-center text-white font-bold">
                Get Tickets
            </a>
        </nav>
    </div>
</header>
{% endwith %}
