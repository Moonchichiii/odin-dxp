{% load cloudinary_helper wagtailcore_tags %}

<section
  class="hero-section relative w-full h-dvh min-h-[700px] flex flex-col overflow-hidden bg-odin-bg"
  aria-labelledby="hero-title"
>
  {# -------------------- 1. BACKGROUND LAYER -------------------- #}
  <div class="absolute inset-0 z-0 select-none">
    {% if self.video_public_id %}
      <video
        class="absolute inset-0 h-full w-full object-cover object-center opacity-60 scale-105"
        autoplay muted loop playsinline preload="auto"
        aria-hidden="true"
        {% if self.poster_public_id %}poster="{% cld_img self.poster_public_id width=1600 %}"{% endif %}
      >
        <source src="{% cld_video self.video_public_id width=1600 %}" type="video/mp4" />
      </video>

    {% elif self.video_upload and self.video_upload.url %}
      <video
        class="absolute inset-0 h-full w-full object-cover object-center opacity-60 scale-105"
        autoplay muted loop playsinline preload="auto"
        aria-hidden="true"
        {% if self.poster_upload %}poster="{{ self.poster_upload.file.url }}"{% endif %}
      >
        <source src="{{ self.video_upload.url }}" type="video/mp4" />
      </video>

    {% else %}
      <div class="absolute inset-0 bg-linear-to-br from-odin-surface to-odin-bg"></div>
    {% endif %}
  </div>

  {# -------------------- 2. OVERLAYS -------------------- #}
  <div class="absolute inset-0 z-10 pointer-events-none bg-hero-vignette"></div>
  <div class="absolute inset-x-0 bottom-0 h-40 z-10 pointer-events-none bg-linear-to-t from-odin-bg to-transparent"></div>

  {# -------------------- 3. CONTENT LAYER -------------------- #}
  {# MOBILE OPTIMIZATION: pt-24 (Higher up) and pb-24 (Clearance for scroll arrow) #}
  <div class="relative z-20 w-full h-full flex flex-col justify-center px-6 pt-24 md:pt-36 pb-24 md:pb-20">

    <div class="w-full max-w-7xl mx-auto flex flex-col items-center text-center">

      {# --- A. THE BRAIN --- #}
      {# MOBILE: mb-4 (Tighter) #}
      <div class="mb-4 md:mb-10 animate-fade-in-up" style="animation-delay: 0.1s">
        {% if self.extra_images %}
          <div class="flex justify-center items-center gap-6">
            {% for img in self.extra_images %}
              {% if img and img.file %}
                <img
                  src="{{ img.file.url }}"
                  alt="{{ img.title|default:'' }}"
                  {# SIZING: Mobile h-24 -> Desktop h-64 -> Wide h-80 #}
                  class="h-24 md:h-40 lg:h-64 xl:h-80 w-auto object-contain drop-shadow-[0_0_35px_rgba(16,185,129,0.5)] animate-pulse"
                  loading="eager"
                  style="animation-duration: 4s;"
                />
              {% endif %}
            {% endfor %}
          </div>
        {% elif self.description %}
          <p class="font-mono text-xs md:text-sm uppercase tracking-[0.2em] text-primary-glow font-bold drop-shadow-md">
            {{ self.description }}
          </p>
        {% endif %}
      </div>

      {# --- B. MAIN HEADLINE --- #}
      {# MOBILE: mb-5 (Tighter gap to buttons) #}
      <h1
        id="hero-title"
        class="
          font-display font-bold text-white text-balance
          text-3xl sm:text-4xl md:text-7xl lg:text-8xl
          leading-[1.1] md:leading-none tracking-tight
          drop-shadow-2xl
          max-w-5xl mx-auto
          mb-5 md:mb-12
          animate-fade-in-up
        "
        style="animation-delay: 0.2s"
      >
        {{ self.title }}

        {% if self.subtitle %}
          {# MOBILE: text-sm (Compact) and mt-2 (Tight) #}
          <span
            class="block mt-2 md:mt-6 text-sm sm:text-base md:text-2xl lg:text-3xl font-normal font-sans tracking-normal text-transparent bg-clip-text bg-linear-to-r from-text-muted via-white to-text-muted max-w-3xl mx-auto"
          >
            {{ self.subtitle }}
          </span>
        {% endif %}
      </h1>

      {# --- C. CTA BUTTONS --- #}
      {% if self.cta_buttons %}
        {# MOBILE: gap-2.5 (Saves vertical space) #}
        <div class="flex flex-col md:flex-row items-center justify-center gap-2.5 md:gap-6 w-full md:w-auto animate-fade-in-up" style="animation-delay: 0.4s">
          {% for item in self.cta_buttons %}
            {% with cta=item.value|default:item %}
              {% if cta.page or cta.url %}
                <a
                  href="{% if cta.page %}{{ cta.page.url }}{% else %}{{ cta.url }}{% endif %}"
                  class="
                    group relative
                    w-full max-w-[320px] md:w-auto md:max-w-none
                    inline-flex items-center justify-center
                    rounded-full
                    py-4 md:py-5 md:px-12
                    text-xs md:text-sm font-bold uppercase tracking-widest
                    transition-all duration-300 ease-out
                    {% if cta.style == 'primary' %}
                      bg-primary text-odin-bg hover:bg-white hover:scale-105 shadow-[0_0_25px_rgba(16,185,129,0.35)]
                    {% elif cta.style == 'secondary' %}
                      glass-panel text-white hover:bg-white/10 hover:border-white/40 hover:scale-105
                    {% else %}
                      text-text-muted hover:text-white underline underline-offset-4 decoration-primary/0 hover:decoration-primary
                    {% endif %}
                  "
                >
                  <span class="relative z-10">{{ cta.label }}</span>
                  {% if cta.style != 'ghost' %}
                    <svg class="ml-2 w-3 h-3 md:w-4 md:h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                    </svg>
                  {% endif %}
                </a>
              {% endif %}
            {% endwith %}
          {% endfor %}
        </div>
      {% endif %}

    </div>
  </div>

  {# --- 4. SCROLL INDICATOR --- #}
  <button
    @click="window.scrollBy({ top: window.innerHeight, behavior: 'smooth' })"
    class="absolute bottom-6 left-1/2 -translate-x-1/2 z-30 flex flex-col items-center gap-2 animate-float opacity-50 hover:opacity-100 transition-opacity cursor-pointer mix-blend-screen"
    aria-label="Scroll down"
  >
    <span class="text-[10px] uppercase tracking-widest text-white/60">Scroll</span>
    <div class="w-px h-12 bg-linear-to-b from-white to-transparent"></div>
  </button>
</section>
