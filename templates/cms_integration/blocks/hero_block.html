{% load cloudinary_helper wagtailcore_tags %}

<section
  class="hero-section relative w-full min-h-screen flex flex-col justify-center overflow-hidden bg-odin-bg"
  aria-labelledby="hero-title"
>
  {# -------------------- 1. BACKGROUND LAYER -------------------- #}
  <div class="absolute inset-0 z-0 select-none">
    {% if self.video_public_id %}
      {# Cloudinary Video #}
      <video
        class="absolute inset-0 h-full w-full object-cover object-[center_20%] opacity-60"
        autoplay muted loop playsinline preload="none"
        aria-hidden="true"
        {% if self.poster_public_id %}poster="{% cld_img self.poster_public_id width=1600 %}"{% endif %}
      >
        <source src="{% cld_video self.video_public_id width=1600 %}" type="video/mp4" />
      </video>

    {% elif self.video_upload and self.video_upload.url %}
      {# Uploaded Video #}
      <video
        class="absolute inset-0 h-full w-full object-cover object-[center_20%] opacity-60"
        autoplay muted loop playsinline preload="none"
        aria-hidden="true"
        {% if self.poster_upload %}poster="{{ self.poster_upload.file.url }}"{% endif %}
      >
        <source src="{{ self.video_upload.url }}" type="video/mp4" />
      </video>

    {% elif self.poster_upload and self.poster_upload.file %}
      {# Static Image #}
      <img
        src="{{ self.poster_upload.file.url }}"
        class="absolute inset-0 h-full w-full object-cover opacity-60"
        alt=""
        aria-hidden="true"
        loading="eager"
        decoding="async"
      />

    {% else %}
      {# Fallback / Default Gradient #}
      <div class="absolute inset-0 bg-gradient-to-br from-odin-surface to-odin-bg opacity-50"></div>
    {% endif %}
  </div>

  {# -------------------- 2. OVERLAYS (Readability) -------------------- #}
  {# Base tint to ensure text pops #}
  <div class="absolute inset-0 z-10 pointer-events-none bg-odin-bg/60"></div>
  {# Header fade (makes the nav legible even when transparent) #}
  <div class="absolute inset-x-0 top-0 h-36 z-10 pointer-events-none bg-gradient-to-b from-odin-bg/90 to-transparent"></div>
  {# Bottom fade (seamless transition to next section) #}
  <div class="absolute inset-x-0 bottom-0 h-72 z-10 pointer-events-none bg-gradient-to-t from-odin-bg via-odin-bg/80 to-transparent"></div>

  {# -------------------- 3. CONTENT LAYER -------------------- #}
  <div class="relative z-20 w-full h-full flex flex-col">

    {# Reserve fixed header height so content is centered visually in the remaining space #}
    <div class="h-20 shrink-0"></div>

    <div class="flex-1 flex items-center justify-center px-6">
      <div class="w-full max-w-7xl flex flex-col items-center text-center">

        {# Extra Logos #}
        {% if self.extra_images %}
          <div class="mb-10 flex flex-wrap justify-center gap-6 animate-fade-in-up" style="animation-delay: 0.1s">
            {% for img in self.extra_images %}
              {% if img and img.file %}
                <img
                  src="{{ img.file.url }}"
                  alt="{{ img.title|default:'' }}"
                  class="h-10 sm:h-12 md:h-16 w-auto object-contain opacity-80 drop-shadow-lg"
                  loading="lazy"
                />
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}

        {# Supertitle #}
        {% if self.description %}
          <p class="font-mono text-xs md:text-sm uppercase tracking-[0.2em] text-primary-glow font-bold mb-6 animate-fade-in-up" style="animation-delay: 0.2s">
            {{ self.description }}
          </p>
        {% endif %}

        {# Main Headline #}
        <h1
          id="hero-title"
          class="
            font-display font-bold text-white text-balance
            text-5xl sm:text-6xl md:text-7xl lg:text-8xl
            leading-[0.95] tracking-tight
            drop-shadow-2xl
            mb-8
            animate-fade-in-up
          "
          style="animation-delay: 0.3s"
        >
          {{ self.title }}
          {% if self.subtitle %}
            <span
              class="block mt-2 text-transparent bg-clip-text bg-gradient-to-r from-primary-glow via-white to-primary"
            >
              {{ self.subtitle }}
            </span>
          {% endif %}
        </h1>

        {# CTA Buttons #}
        {% if self.cta_buttons %}
          <div class="flex flex-col sm:flex-row items-center justify-center gap-4 w-full sm:w-auto animate-fade-in-up" style="animation-delay: 0.5s">
            {% for item in self.cta_buttons %}
              {% with cta=item.value|default:item %}
                {# Defensive check: ensure we have a destination #}
                {% if cta.page or cta.url %}
                  <a
                    href="{% if cta.page %}{{ cta.page.url }}{% else %}{{ cta.url }}{% endif %}"
                    class="
                      group relative w-full sm:w-auto min-w-[180px]
                      inline-flex items-center justify-center
                      rounded-full px-8 py-4
                      text-xs font-bold uppercase tracking-widest
                      transition-all duration-300
                      {% if cta.style == 'primary' %}
                        bg-primary text-odin-bg hover:bg-white hover:scale-105 shadow-[0_0_25px_rgba(16,185,129,0.3)]
                      {% elif cta.style == 'secondary' %}
                        border border-white/20 bg-black/20 backdrop-blur-md text-white hover:bg-white/10 hover:border-white hover:scale-105
                      {% else %}
                        text-text-muted hover:text-white underline underline-offset-4 decoration-primary/0 hover:decoration-primary
                      {% endif %}
                    "
                  >
                    {{ cta.label }}
                    {% if cta.style != 'ghost' %}
                      <svg class="ml-2 w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                      </svg>
                    {% endif %}
                  </a>
                {% endif %}
              {% endwith %}
            {% endfor %}
          </div>
        {% endif %}

      </div>
    </div>
  </div>

  {# Scroll Indicator #}
  <div class="absolute bottom-10 left-1/2 -translate-x-1/2 z-30 pointer-events-none animate-bounce opacity-50">
    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
    </svg>
  </div>
</section>
